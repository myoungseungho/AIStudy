<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>에폭, 배치, 이터레이션이 뭐야? - Section 4</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #fafafa;
            color: #333;
            line-height: 1.9;
        }
        .container { max-width: 800px; margin: 0 auto; padding: 60px 20px; }
        .breadcrumb { margin-bottom: 24px; font-size: 0.9rem; }
        .breadcrumb a { color: #666; text-decoration: none; }
        .breadcrumb a:hover { text-decoration: underline; }
        .breadcrumb span { color: #999; margin: 0 8px; }
        .header { margin-bottom: 48px; }
        .topic-number {
            display: inline-block;
            background: #9C27B0;
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 16px;
        }
        .header h1 { font-size: 2rem; font-weight: 700; color: #111; margin-bottom: 12px; }
        .header p { color: #666; font-size: 1.1rem; }
        .conversation {
            background: white;
            border-radius: 16px;
            padding: 32px;
            margin: 32px 0;
            border: 1px solid #e0e0e0;
        }
        .conversation h2 {
            font-size: 1.3rem;
            color: #9C27B0;
            margin-bottom: 24px;
            padding-bottom: 12px;
            border-bottom: 2px solid #f3e5f5;
        }
        .chat { margin-bottom: 20px; }
        .q {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 16px 20px;
            margin: 16px 0;
            border-radius: 0 12px 12px 0;
            font-weight: 500;
        }
        .q::before { content: "Q. "; color: #e65100; font-weight: 700; }
        .a { padding: 8px 0 8px 20px; border-left: 4px solid #e0e0e0; margin: 12px 0; }
        .a p { margin-bottom: 12px; }
        .a p:last-child { margin-bottom: 0; }
        .highlight {
            background: #e3f2fd;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: 600;
            color: #1565c0;
        }
        .key-point {
            background: #f3e5f5;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: 600;
            color: #6a1b9a;
        }
        .warning {
            background: #ffcdd2;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: 600;
            color: #c62828;
        }
        .code-block {
            background: #263238;
            border-radius: 8px;
            padding: 16px 20px;
            margin: 16px 0;
            font-family: 'Consolas', monospace;
            font-size: 0.9rem;
            color: #eceff1;
            overflow-x: auto;
            line-height: 1.6;
            white-space: pre-wrap;
        }
        .summary-box {
            background: linear-gradient(135deg, #9C27B0 0%, #BA68C8 100%);
            border-radius: 16px;
            padding: 32px;
            color: white;
            margin: 32px 0;
        }
        .summary-box h3 { font-size: 1.2rem; margin-bottom: 20px; }
        .summary-box ul { list-style: none; }
        .summary-box li {
            padding: 8px 0;
            padding-left: 24px;
            position: relative;
        }
        .summary-box li::before {
            content: "→";
            position: absolute;
            left: 0;
            color: #f3e5f5;
        }
        .nav-links {
            display: flex;
            justify-content: space-between;
            margin-top: 60px;
            padding-top: 24px;
            border-top: 1px solid #e0e0e0;
        }
        .nav-links a { color: #9C27B0; text-decoration: none; font-weight: 500; }
        .nav-links a:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <div class="container">
        <nav class="breadcrumb">
            <a href="../../">AI 공부</a>
            <span>/</span>
            <a href="../">Section 4</a>
            <span>/</span>
            Topic 14
        </nav>

        <header class="header">
            <div class="topic-number">TOPIC 14</div>
            <h1>에폭, 배치, 이터레이션이 뭐야?</h1>
            <p>Q. 데이터를 몇 번 학습시켜?</p>
        </header>

        <div class="conversation">
            <h2>Part 1. 용어 정리</h2>

            <div class="chat">
                <div class="q">에폭(Epoch), 배치(Batch), 이터레이션(Iteration)이 뭐야?</div>
                <div class="a">
                    <p>헷갈리기 쉬운 용어들이야. 하나씩 정리할게.</p>
                </div>
            </div>

            <div class="code-block">정의:

배치 (Batch):
- 한 번에 처리하는 데이터 개수
- 예: 배치 크기 32 = 32개씩 묶어서 처리

이터레이션 (Iteration):
- 배치 하나를 처리하는 단위
- 가중치 업데이트 1회 = 이터레이션 1회

에폭 (Epoch):
- 전체 데이터를 한 번 다 본 것
- 모든 데이터로 학습 1회 = 에폭 1회</code>
</div>
        </div>

        <div class="conversation">
            <h2>Part 2. 구체적인 예시</h2>

            <div class="chat">
                <div class="q">예를 들어줘.</div>
                <div class="a">
                    <p>계산해볼게.</p>
                </div>
            </div>

            <div class="code-block">예시:

데이터:
- 전체 데이터: 1000개
- 배치 크기: 32

계산:
- 1 이터레이션 = 32개 처리
- 1 에폭 = 1000개 ÷ 32 = 31.25 → 32 이터레이션
  (마지막 배치는 8개만)
- 10 에폭 = 32 × 10 = 320 이터레이션


흐름:

Epoch 1:
  Iteration 1: 데이터 1~32 처리 → 가중치 업데이트
  Iteration 2: 데이터 33~64 처리 → 가중치 업데이트
  ...
  Iteration 32: 데이터 993~1000 처리 → 가중치 업데이트

Epoch 2:
  Iteration 33: 데이터 1~32 처리 (다시)
  Iteration 34: 데이터 33~64 처리 (다시)
  ...

→ Epoch 10 완료 시:
  - 총 320번 가중치 업데이트
  - 각 데이터를 10번씩 봄</code>
        </div>
        </div>

        <div class="conversation">
            <h2>Part 3. 배치 크기의 영향</h2>

            <div class="chat">
                <div class="q">배치 크기는 어떻게 정해?</div>
                <div class="a">
                    <p>배치 크기에 따라 학습이 달라져.</p>
                </div>
            </div>

            <div class="code-block">배치 크기 비교:

작은 배치 (예: 32):
장점:
✅ 메모리 적게 사용
✅ 일반화 성능 좋음
✅ 정규화 효과 (노이즈가 학습에 도움)
✅ GPU 없어도 학습 가능

단점:
❌ 학습 속도 느림
❌ 기울기가 노이즈 많음
❌ 병렬 처리 효율 낮음


큰 배치 (예: 512):
장점:
✅ 학습 속도 빠름
✅ 기울기 안정적
✅ 병렬 처리 효율 높음
✅ GPU 활용 극대화

단점:
❌ 메모리 많이 사용
❌ 일반화 성능 낮을 수 있음
❌ 지역 최솟값에 갇힐 위험
❌ 학습률 조정 필요


일반적인 선택:
- 이미지: 32, 64, 128
- 텍스트: 16, 32
- GPU 메모리에 맞춰 조정
- 2의 거듭제곱 (32, 64, 128, 256...)</code>
        </div>
        </div>

        <div class="conversation">
            <h2>Part 4. 몇 에폭 학습해야 해?</h2>

            <div class="chat">
                <div class="q">에폭은 몇 번 하면 돼?</div>
                <div class="a">
                    <p><span class="highlight">정답은 없어. 데이터와 문제에 따라 달라.</span></p>
                </div>
            </div>

            <div class="code-block">에폭 수 가이드:

일반적인 범위:
- 간단한 문제: 10~50 에폭
- 중간 복잡도: 50~200 에폭
- 복잡한 문제: 100~500 에폭
- 대규모 모델: 1~10 에폭 (데이터가 많아서)


Early Stopping:
검증 손실이 개선 안 되면 조기 종료

예:
Epoch 1: val_loss = 0.8
Epoch 5: val_loss = 0.5
Epoch 10: val_loss = 0.3
Epoch 15: val_loss = 0.35 ← 증가!
Epoch 20: val_loss = 0.36 ← 계속 증가
→ Epoch 10에서 멈추고 그때 모델 사용


코드:
from torch.optim.lr_scheduler import ReduceLROnPlateau

best_loss = float('inf')
patience = 5
counter = 0

for epoch in range(100):
    train(...)
    val_loss = validate(...)

    if val_loss < best_loss:
        best_loss = val_loss
        save_model()
        counter = 0
    else:
        counter += 1

    if counter >= patience:
        print(f"Early stopping at epoch {epoch}")
        break</code>
        </div>
        </div>

        <div class="conversation">
            <h2>Part 5. 실전 팁</h2>

            <div class="code-block">배치 크기 결정:

1. GPU 메모리 확인:
   - 큰 배치로 시작
   - OOM 에러 나면 절반으로
   - 반복해서 최대 크기 찾기

2. 학습 안정성:
   - 작은 배치로 시작 (32)
   - 학습 잘 되면 늘리기
   - 불안정하면 줄이기

3. 배치 크기 vs 학습률:
   배치 크기 2배 → 학습률도 2배
   (Linear Scaling Rule)


에폭 수 결정:

1. 과적합 모니터링:
   train_loss와 val_loss 그래프
   val_loss 증가 시작하면 멈추기

2. 학습 곡선 관찰:
   Loss가 plateau → 더 학습해도 소용없음
   Learning rate 줄이거나 종료

3. 시간 제약:
   1 epoch 10분 걸리고 100 epoch 필요
   → 1000분 = 17시간
   현실적으로 가능한지 판단


실전 전략:
1. 작은 데이터로 빠르게 실험 (10 epoch)
2. 잘 작동하면 전체 데이터로 (50 epoch)
3. Early stopping으로 자동 종료
4. 최고 성능 모델 저장</code>
        </div>
        </div>

        <div class="conversation">
            <h2>Part 6. 학습 진행 상황 출력</h2>

            <div class="code-block">전형적인 학습 로그:

Epoch 1/100
[=====>....] 50% | Iteration 500/1000 | Loss: 2.45 | 5.2s/iter
[==========] 100% | Iteration 1000/1000 | Loss: 1.82 | Epoch time: 87min
Val Loss: 1.95 | Val Acc: 45.2%

Epoch 2/100
[=====>....] 50% | Iteration 500/1000 | Loss: 1.23 | 5.1s/iter
[==========] 100% | Iteration 1000/1000 | Loss: 1.05 | Epoch time: 85min
Val Loss: 1.12 | Val Acc: 62.8%

...

Epoch 25/100
[==========] 100% | Iteration 1000/1000 | Loss: 0.15 | Epoch time: 83min
Val Loss: 0.31 | Val Acc: 91.5%
✓ New best model saved!

Epoch 30/100
Val Loss: 0.32 (no improvement for 5 epochs)
⚠ Early stopping triggered


PyTorch 코드:

from tqdm import tqdm

for epoch in range(num_epochs):
    model.train()
    total_loss = 0

    # 진행 표시줄
    pbar = tqdm(train_loader, desc=f'Epoch {epoch+1}/{num_epochs}')

    for i, (data, target) in enumerate(pbar):
        # 학습
        loss = train_step(data, target)
        total_loss += loss

        # 진행 상황 업데이트
        pbar.set_postfix({
            'loss': f'{loss:.4f}',
            'avg_loss': f'{total_loss/(i+1):.4f}'
        })

    # 검증
    val_loss = validate()
    print(f'Epoch {epoch+1}: Val Loss = {val_loss:.4f}')</code>
        </div>
        </div>

        <div class="summary-box">
            <h3>핵심 정리</h3>
            <ul>
                <li><strong>배치 = 한 번에 처리하는 데이터</strong> - 보통 32, 64, 128 사용</li>
                <li><strong>이터레이션 = 배치 1개 처리</strong> - 가중치 업데이트 1회</li>
                <li><strong>에폭 = 전체 데이터 1회</strong> - 여러 이터레이션의 합</li>
                <li><strong>배치 크기 트레이드오프</strong> - 크면 빠르지만 메모리 많이, 작으면 일반화 좋음</li>
                <li><strong>Early Stopping 활용</strong> - 검증 손실 모니터링으로 최적 에폭 자동 결정</li>
            </ul>
        </div>

        <div class="nav-links">
            <a href="../topic13/">← 이전: 옵티마이저가 뭐야?</a>
            <a href="../topic15/">다음: GPU는 왜 필요해? →</a>
        </div>
    </div>
</body>
</html>
